(this["webpackJsonppdf-editor"]=this["webpackJsonppdf-editor"]||[]).push([[0],{160:function(e,t,n){e.exports=n(291)},165:function(e,t,n){},291:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(27),i=n.n(o),c=(n(165),n(45)),s=n(149),u=n(8),l=n.n(u),d=n(11),p=n(130),f=n(131),m=n(148),h=n(150),g=(n(167),n(302)),v=n(303),b=n(40),w=n(300),x=n(297),y=n(301),j=n(299),O=n(304),P=[{name:"pdfjsLib",src:"https://unpkg.com/pdfjs-dist@2.3.200/build/pdf.min.js"},{name:"PDFLib",src:"https://unpkg.com/pdf-lib@1.4.0/dist/pdf-lib.min.js"},{name:"download",src:"https://unpkg.com/downloadjs@1.4.7"},{name:"makeTextPDF",src:"https://cdn.jsdelivr.net/gh/snamoah/react-pdf-editor/public/makeTextPDF.js"}],E={},k=function(e){return E[e]},D={Courier:{correction:function(e,t){return(e*t-e)/2+e/6}},Helvetica:{correction:function(e,t){return(e*t-e)/2+e/10}},"Times-Roman":{correction:function(e,t){return(e*t-e)/2+e/7}}},F=Object(c.a)({},D,{"\u6a19\u6977\u9ad4":{src:"/CK.ttf",correction:function(e,t){return(e*t-e)/2}}}),I=function(e){if(D[e])return D[e];var t=F[e];if(!t)throw new Error("Font '".concat(e,"' not exists."));D[e]=fetch(t.src).then((function(e){return e.arrayBuffer()})).then((function(n){var a=new window.FontFace(e,n);return a.display="swap",a.load().then((function(){return document.fonts.add(a)})),Object(c.a)({},t,{buffer:n})}))},S=function(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(){return t(a.result)},a.onerror=n,a.readAsArrayBuffer(e)}))},M=function(e){return new Promise((function(t,n){var a=new Image;if(a.onload=function(){return t(a)},a.onerror=n,e instanceof Blob){var r=window.URL.createObjectURL(e);a.src=r}else a.src=e}))};function C(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(){return t(a.result)},a.onerror=n,a.readAsDataURL(e)}))}function U(e){return L.apply(this,arguments)}function L(){return(L=Object(d.a)(l.a.mark((function e(t){var n,a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k("pdfjsLib");case 2:return n=e.sent,a=new Blob([t]),r=window.URL.createObjectURL(a),e.abrupt("return",n.getDocument(r).promise);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var A=n(12);function R(){var e=0;return function(){return e++}}var B=function(){};function H(e,t,n){return T.apply(this,arguments)}function T(){return(T=Object(d.a)(l.a.mark((function e(t,n,a){var r,o,i,c,s,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k("PDFLib");case 2:return r=e.sent,e.next=5,k("download");case 5:return o=e.sent,e.next=8,k("makeTextPDF");case 8:return i=e.sent,e.prev=9,e.t0=r.PDFDocument,e.next=13,S(t);case 13:return e.t1=e.sent,e.next=16,e.t0.load.call(e.t0,e.t1);case 16:c=e.sent,e.next=23;break;case 19:throw e.prev=19,e.t2=e.catch(9),console.log("Failed to load PDF."),e.t2;case 23:return s=c.getPages().map(function(){var e=Object(d.a)(l.a.mark((function e(t,a){var o,s,u,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n[a],s=t.getHeight(),u=t.getWidth(),p=o.map(function(){var e=Object(d.a)(l.a.mark((function e(n){var a,o,d,p,f,m,h,g,v,b,w,x,y,j,O,P,E,k,D,F,M,C,U,L,R,H;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("image"!==n.type){e.next=29;break}if(a=n.file,o=n.x,d=n.y,p=n.width,f=n.height,e.prev=2,"image/jpeg"!==a.type){e.next=13;break}return e.t0=c,e.next=7,S(a);case 7:return e.t1=e.sent,e.next=10,e.t0.embedJpg.call(e.t0,e.t1);case 10:m=e.sent,e.next=20;break;case 13:return e.t2=c,e.next=16,S(a);case 16:return e.t3=e.sent,e.next=19,e.t2.embedPng.call(e.t2,e.t3);case 19:m=e.sent;case 20:return e.abrupt("return",(function(){return t.drawImage(m,{x:o,y:s-d-f,width:p,height:f})}));case 23:return e.prev=23,e.t4=e.catch(2),console.log("Failed to embed image.",e.t4),e.abrupt("return",B);case 27:e.next=50;break;case 29:if("text"!==n.type){e.next=46;break}return h=n.x,g=n.y,v=n.lines,b=n.lineHeight,w=n.size,x=n.fontFamily,e.next=33,I(x);case 33:return y=e.sent,e.t5=c,e.next=37,i({lines:v,fontSize:w,lineHeight:b,width:u,height:s,font:(null===y||void 0===y?void 0:y.buffer)||x,dy:y&&y.correction&&y.correction(w,b)});case 37:return e.t6=e.sent,e.next=40,e.t5.embedPdf.call(e.t5,e.t6);case 40:return j=e.sent,O=Object(A.a)(j,1),P=O[0],e.abrupt("return",(function(){return t.drawPage(P,{width:u,height:s,x:h,y:-g})}));case 46:if("drawing"!==n.type){e.next=50;break}return E=n.x,k=n.y,D=n.path,F=n.scale,M=r.pushGraphicsState,C=r.setLineCap,U=r.popGraphicsState,L=r.setLineJoin,R=r.LineCapStyle,H=r.LineJoinStyle,e.abrupt("return",(function(){t.pushOperators(M(),C(R.Round),L(H.Round)),t.drawSvgPath(D,{borderWidth:5,scale:F,x:E,y:s-k}),t.pushOperators(U())}));case 50:case"end":return e.stop()}}),e,null,[[2,23]])})));return function(t){return e.apply(this,arguments)}}()),e.next=6,Promise.all(p);case 6:e.sent.forEach((function(e){return e()}));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=26,Promise.all(s);case 26:return e.prev=26,e.next=29,c.save();case 29:u=e.sent,o(u,a,"application/pdf"),e.next=37;break;case 33:throw e.prev=33,e.t3=e.catch(26),console.log("Failed to save PDF."),e.t3;case 37:case"end":return e.stop()}}),e,null,[[9,19],[26,33]])})))).apply(this,arguments)}var W=function(e){var t=e.page,n=e.updateDimensions,o=Object(a.createRef)(),i=Object(a.useState)(500),c=Object(A.a)(i,2),s=c[0],u=c[1],p=Object(a.useState)(window.innerHeight),f=Object(A.a)(p,2),m=f[0],h=f[1],g=function(){var e=Object(d.a)(l.a.mark((function e(t){var a,r,i,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(!(a=e.sent)){e.next=12;break}if(i=null===(r=o.current)||void 0===r?void 0:r.getContext("2d"),c=a.getViewport({scale:1}),u(c.width),h(c.height),!i){e.next=12;break}return e.next=11,a.render({canvasContext:null===(s=o.current)||void 0===s?void 0:s.getContext("2d"),viewport:c}).promise;case 11:n({width:c.width,height:c.height});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){g(t)}),[t,s,m]),r.a.createElement("div",null,r.a.createElement("canvas",{ref:o,width:s,height:m}))},z=function(e,t,n,a,r,o,i,c){var s=t+a,u=e+n;return{top:s<0?0:s+o>c+25?c-o+25:s,left:u<0?0:u+r>i+25?i-r+25:u}},X=function(e){var t=e.x,n=e.y,o=e.payload,i=e.width,c=e.height,s=e.pageWidth,u=e.pageHeight,l=e.updateImageObject,d=Object(a.createRef)(),p=Object(a.useState)(i),f=Object(A.a)(p,2),m=f[0],h=f[1],g=Object(a.useState)(c),v=Object(A.a)(g,2),b=v[0],w=v[1],x=Object(a.useState)(!1),y=Object(A.a)(x,2),j=y[0],O=y[1],P=Object(a.useState)(n),E=Object(A.a)(P,2),k=E[0],D=E[1],F=Object(a.useState)(t),I=Object(A.a)(F,2),S=I[0],M=I[1],C=Object(a.useState)([]),U=Object(A.a)(C,2),L=U[0],R=U[1],B=function(e){e.preventDefault(),O(!0);var t=e.currentTarget.dataset.direction;t&&R(t.split("-"))},H=function(e){e.preventDefault(),O(!1);var t=z(S,k,e.movementX,e.movementY,m,b,s,u),n=t.top,a=t.left;l({x:a,y:n,width:m,height:b})},T=function(e){e.preventDefault(),j&&(L.includes("left")&&(M(S+e.movementX),h(m-e.movementX)),L.includes("top")&&(D(k+e.movementY),w(b-e.movementY)),L.includes("right")&&(M(S-e.movementX),h(m+e.movementX)),L.includes("bottom")&&(D(k-e.movementY),w(b+e.movementY)))};return Object(a.useEffect)((function(){!function(e){var t=d.current&&d.current.getContext("2d");if(t){var n=m,a=b;if(m>300)h(n=m*(300/m));if(b>300)w(a=b*(300/c));t.drawImage(o,0,0,n,a),d.current&&d.current.toBlob((function(e){l({file:e,width:n,height:a})}))}}()}),[o,m,b]),r.a.createElement("div",{onMouseDown:B,onMouseMove:function(e){if(e.preventDefault(),j){var t=z(S,k,e.movementX,e.movementY,m,b,s,u),n=t.top,a=t.left;D(n),M(a)}},onMouseUp:H,onMouseOut:H,style:{position:"absolute",top:k,left:S,borderStyle:"dashed",borderWidth:"1px",borderColor:"grey",width:m+2,height:b+2,cursor:"move"}},r.a.createElement("div",{style:{position:"relative"}},r.a.createElement("canvas",{ref:d,width:m,height:b}),r.a.createElement("div",{"data-direction":"top-left",onMouseDown:B,onMouseUp:H,onMouseMove:T,style:{position:"absolute",cursor:"nwse-resize",top:0,left:0,width:20,height:20}}),r.a.createElement("div",{"data-direction":"top-right",onMouseDown:B,onMouseUp:H,onMouseMove:T,style:{position:"absolute",top:0,right:0,cursor:"nesw-resize",width:20,height:20}}),r.a.createElement("div",{"data-direction":"bottom-left",onMouseDown:B,onMouseUp:H,onMouseMove:T,style:{position:"absolute",cursor:"nesw-resize",left:0,bottom:Math.round(10),width:20,height:20}}),r.a.createElement("div",{"data-direction":"bottom-right",onMouseDown:B,onMouseUp:H,onMouseMove:T,style:{position:"absolute",bottom:Math.round(10),right:0,width:20,height:20,cursor:"nwse-resize"}})))},Y=function(e){Object(h.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(p.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={pdfFile:void 0,selectedPageIndex:-1,pdfName:"",pages:[],allObjects:[],pagesScale:[],pageDimensions:[],saving:!1,uploading:!1},e.onUploadPDF=function(){var t=Object(d.a)(l.a.mark((function t(n){var a,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.setState({uploading:!0}),a=n.target.files||n.dataTransfer&&n.dataTransfer.files){t.next=4;break}return t.abrupt("return");case 4:if((r=a[0])&&"application/pdf"===r.type){t.next=7;break}return t.abrupt("return");case 7:return e.setState({selectedPageIndex:-1}),t.prev=8,t.next=11,e.addPDF(r);case 11:e.setState({selectedPageIndex:0}),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(8),console.log(t.t0);case 17:return t.prev=17,e.setState({uploading:!1}),t.finish(17);case 20:case"end":return t.stop()}}),t,null,[[8,14,17,20]])})));return function(e){return t.apply(this,arguments)}}(),e.addPDF=function(){var t=Object(d.a)(l.a.mark((function t(n){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,U(n);case 3:a=t.sent,e.setState({pdfName:n.name,pdfFile:n,pages:Array(a.numPages).fill(0).map((function(e,t){return a.getPage(t+1)})),allObjects:Array(a.numPages).fill([]),pagesScale:Array(a.numPages).fill(1),pageDimensions:Array(a.numPages).fill({width:0,height:0})}),t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(0),console.log("Failed to add pdf."),t.t0;case 11:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}(),e.savePDF=Object(d.a)(l.a.mark((function t(){var n,a,r,o,i,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.state,a=n.pdfFile,r=n.saving,o=n.pages,i=n.allObjects,c=n.pdfName,a&&!r&&o.length){t.next=3;break}return t.abrupt("return");case 3:return e.setState({saving:!0}),t.prev=4,t.next=7,H(a,i,c);case 7:t.next=12;break;case 9:t.prev=9,t.t0=t.catch(4),console.log(t.t0);case 12:return t.prev=12,e.setState({saving:!1}),t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[4,9,12,15]])}))),e.renderHiddenInputs=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{type:"file",name:"pdf",id:"pdf",accept:"application/pdf",onChange:e.onUploadPDF,style:{display:"none"}}),e.state.selectedPageIndex>-1&&r.a.createElement("input",{type:"file",id:"image",name:"image",accept:"image/*",style:{display:"none"},onChange:e.onUploadImage}))},e.onUploadImage=function(t){var n=e.state.selectedPageIndex,a=t.target.files&&t.target.files[0];a&&n>=0&&(e.addImage(a),t.currentTarget.value="")},e.addImage=function(){var t=Object(d.a)(l.a.mark((function t(n){var a,r,o,i,c,u,d,p,f;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.state,r=a.allObjects,o=a.selectedPageIndex,t.prev=1,t.next=4,C(n);case 4:return i=t.sent,t.next=7,M(i);case 7:c=t.sent,u=R(),d=c.width,p=c.height,f={id:u,type:"image",width:d,height:p,x:0,y:0,payload:c,file:n},e.setState({allObjects:r.map((function(e,t){return t===o?[].concat(Object(s.a)(e),[f]):e}))}),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(1),console.log("Fail to add image.",t.t0);case 17:case"end":return t.stop()}}),t,null,[[1,14]])})));return function(e){return t.apply(this,arguments)}}(),e.handleFileInput=function(e){return function(){var t;null===(t=document.getElementById(e))||void 0===t||t.click()}},e.renderEmpty=function(){return r.a.createElement(g.a,{placeholder:!0,loading:e.state.uploading,style:{height:"80vh"}},r.a.createElement(v.a,{icon:!0},r.a.createElement(b.a,{name:"file pdf outline"}),"Upload your PDF to start editing!"),r.a.createElement(w.a,{primary:!0,onClick:e.handleFileInput("pdf")},"Load PDF"))},e.nextPage=function(){e.setState((function(e){return{selectedPageIndex:e.selectedPageIndex+1}}))},e.previousPage=function(){e.setState((function(e){return{selectedPageIndex:e.selectedPageIndex-1}}))},e.updateObject=function(t,n,a){var r=e.state.allObjects,o=r[n],i=o[t],s=Object(c.a)({},i,{},a);o[t]=s,e.setState({allObjects:r.map((function(e,t){return n===t?o:e}))})},e.updatePageDimensions=function(t,n){e.setState({pageDimensions:e.state.pageDimensions.map((function(e,a){return t===a?n:e}))})},e.removeObject=function(t,n){var a=e.state.allObjects,r=a[n];r.splice(t,1),a[n]=r,e.setState({allObjects:a})},e}return Object(f.a)(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.allObjects,a=t.pdfName,o=t.pdfFile,i=t.pages,c=t.saving,s=t.selectedPageIndex,u=t.pageDimensions,l=i.length>1,d=s===i.length-1,p=i[s],f=n[s],m=u[s];return r.a.createElement(x.a,{style:{margin:30}},this.renderHiddenInputs(),r.a.createElement(y.a,{pointing:!0},r.a.createElement(y.a.Item,{header:!0},"PDF Editor"),r.a.createElement(y.a.Menu,{position:"right"},o&&r.a.createElement(r.a.Fragment,null,r.a.createElement(j.a,{item:!0,closeOnBlur:!0,icon:"edit outline",simple:!0},r.a.createElement(j.a.Menu,null,r.a.createElement(j.a.Item,{onClick:this.handleFileInput("image")},"Add Image"),r.a.createElement(j.a.Item,null,"Add Drawing"))),r.a.createElement(y.a.Item,{name:c?"Saving...":"Save",disabled:c,onClick:this.savePDF})),r.a.createElement(y.a.Item,{name:"Upload new PDF",onClick:this.handleFileInput("pdf")}))),o?r.a.createElement(O.a,null,r.a.createElement(O.a.Row,null,r.a.createElement(O.a.Column,{width:3,verticalAlign:"middle"},l&&0!==s&&r.a.createElement(w.a,{circular:!0,icon:"angle left",onClick:this.previousPage})),r.a.createElement(O.a.Column,{width:10},p&&r.a.createElement(g.a,{style:{position:"relative"},compact:!0,stacked:l&&!d},r.a.createElement(W,{updateDimensions:function(t){return e.updatePageDimensions(s,t)},page:p}),f&&f.map((function(t,n){return"image"===t.type?r.a.createElement(X,Object.assign({removeImage:function(){return e.removeObject(n,s)},key:"".concat(a,"-").concat(n),pageWidth:m.width,pageHeight:m.height,updateImageObject:function(t){return e.updateObject(n,s,t)}},t)):null})))),r.a.createElement(O.a.Column,{width:3,verticalAlign:"middle",textAlign:"right"},l&&s!==i.length-1&&r.a.createElement(w.a,{circular:!0,icon:"angle right",onClick:this.nextPage})))):this.renderEmpty())}}]),n}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));P.forEach((function(e){var t=e.name,n=e.src;E[t]=new Promise((function(e,a){var r=document.createElement("script");r.src=n,r.onload=function(){e(window[t]),console.log("".concat(t," is loaded."))},r.onerror=function(){return a("The script ".concat(t," didn't load correctly."))},document.body.appendChild(r)}))})),i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Y,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[160,1,2]]]);
//# sourceMappingURL=main.4d64a3e8.chunk.js.map